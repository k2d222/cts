#!/usr/bin/env deno --allow-read --allow-write --allow-env

// Get the current git hash, and save (overwrite) it into gen/.../version.ts
// so it can be read when running inside the browser.

/* eslint-disable no-console */

import { existsSync, mkdirSync, writeFileSync } from 'node:fs';

const myself = 'tools/gen_version';
if (!existsSync(myself)) {
  console.error('Must be run from repository root');
  process.exit(1);
}

import { version } from '../src/common/tools/version.ts';

mkdirSync('./gen/common/internal', { recursive: true });
// This will be copied into the various other build directories.
writeFileSync(
  './gen/common/internal/version.ts',
  `\
// AUTO-GENERATED - DO NOT EDIT. See ${myself}.

export const version = '${version}';
`
);
